version: 2
jobs:
    build:

        working_directory: ~/morpher-api

        docker:
            - image: szgabsz91/jdk-ocamorph-pyphen:12.0.0

        steps:

            - checkout

            - run:
                name: Clean
                command: ./gradlew clean

            - run:
                name: Assemble
                command: ./gradlew compileJava compileTestJava assemble

            - run:
                name: Test
                command: ./gradlew test

            - run:
                name: Check
                command: ./gradlew check

            - run:
                name: Javadoc
                command: ./gradlew javadoc

            - run:
                name: Install
                command: ./gradlew install

            - run:
                name: Collect test results
                command: |
                    mkdir -p ~/morpher-api/build/test-report
                    find . -type f -name "TEST*.xml" -exec cp {} ~/morpher-api/build/test-report \;
                when: always

            - store_test_results:
                path: ~/morpher-api/build/test-report
